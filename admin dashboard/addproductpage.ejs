<html>

<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
        crossorigin="anonymous">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <style>
    body{
        background-color: #ffffff;
background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg stroke='%23CCC' stroke-width='0' %3E%3Crect fill='%23F5F5F5' x='-60' y='-60' width='110' height='240'/%3E%3C/g%3E%3C/svg%3E");
         /* background-color: #ffffff;
background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='100' height='50' viewBox='0 0 100 50'%3E%3Cdefs%3E%3Crect stroke='%23ffffff' stroke-width='0.18' width='1' height='1' id='s'/%3E%3Cpattern id='a' width='2' height='2' patternUnits='userSpaceOnUse'%3E%3Cg stroke='%23ffffff' stroke-width='0.18'%3E%3Crect fill='%23fafafa' width='1' height='1'/%3E%3Crect fill='%23ffffff' width='1' height='1' x='1' y='1'/%3E%3Crect fill='%23f5f5f5' width='1' height='1' y='1'/%3E%3Crect fill='%23f0f0f0' width='1' height='1' x='1'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='b' width='5' height='11' patternUnits='userSpaceOnUse'%3E%3Cg fill='%23ebebeb'%3E%3Cuse xlink:href='%23s' x='2' y='0'/%3E%3Cuse xlink:href='%23s' x='4' y='1'/%3E%3Cuse xlink:href='%23s' x='1' y='2'/%3E%3Cuse xlink:href='%23s' x='2' y='4'/%3E%3Cuse xlink:href='%23s' x='4' y='6'/%3E%3Cuse xlink:href='%23s' x='0' y='8'/%3E%3Cuse xlink:href='%23s' x='3' y='9'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='c' width='7' height='7' patternUnits='userSpaceOnUse'%3E%3Cg fill='%23e5e5e5'%3E%3Cuse xlink:href='%23s' x='1' y='1'/%3E%3Cuse xlink:href='%23s' x='3' y='4'/%3E%3Cuse xlink:href='%23s' x='5' y='6'/%3E%3Cuse xlink:href='%23s' x='0' y='3'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='d' width='11' height='5' patternUnits='userSpaceOnUse'%3E%3Cg fill='%23ffffff'%3E%3Cuse xlink:href='%23s' x='1' y='1'/%3E%3Cuse xlink:href='%23s' x='6' y='3'/%3E%3Cuse xlink:href='%23s' x='8' y='2'/%3E%3Cuse xlink:href='%23s' x='3' y='0'/%3E%3Cuse xlink:href='%23s' x='0' y='3'/%3E%3C/g%3E%3Cg fill='%23e0e0e0'%3E%3Cuse xlink:href='%23s' x='8' y='3'/%3E%3Cuse xlink:href='%23s' x='4' y='2'/%3E%3Cuse xlink:href='%23s' x='5' y='4'/%3E%3Cuse xlink:href='%23s' x='10' y='0'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='e' width='47' height='23' patternUnits='userSpaceOnUse'%3E%3Cg fill='%23343a40'%3E%3Cuse xlink:href='%23s' x='2' y='5'/%3E%3Cuse xlink:href='%23s' x='23' y='13'/%3E%3Cuse xlink:href='%23s' x='4' y='18'/%3E%3Cuse xlink:href='%23s' x='35' y='9'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='f' width='61' height='31' patternUnits='userSpaceOnUse'%3E%3Cg fill='%23343a40'%3E%3Cuse xlink:href='%23s' x='16' y='0'/%3E%3Cuse xlink:href='%23s' x='13' y='22'/%3E%3Cuse xlink:href='%23s' x='44' y='15'/%3E%3Cuse xlink:href='%23s' x='12' y='11'/%3E%3C/g%3E%3C/pattern%3E%3C/defs%3E%3Crect fill='url(%23a)' width='100' height='50'/%3E%3Crect fill='url(%23b)' width='100' height='50'/%3E%3Crect fill='url(%23c)' width='100' height='50'/%3E%3Crect fill='url(%23d)' width='100' height='50'/%3E%3Crect fill='url(%23e)' width='100' height='50'/%3E%3Crect fill='url(%23f)' width='100' height='50'/%3E%3C/svg%3E");
background-attachment: fixed;
background-size: cover; */
    }
    .navbar-light1{
        background-color:#343a40 !important;
   }
    .table-dark{
        background-color:#ffffff !important;
        color:#343a40 !important;
    }
    .navbar-light .navbar-brand {
    color: #ffffff;
}

.navbar-light .navbar-nav .nav-link {
    color: rgb(245, 245, 245);
}


.navbar-light .navbar-nav .nav-link {
    color: rgb(255, 255, 255);
}


        label,
        input {
            display: block;
        }

        input.text {
            margin-bottom: 12px;
            width: 95%;
            padding: .4em;
        }

        fieldset {
            padding: 0;
            border: 0;
            margin-top: 25px;
        }

        h1 {
            font-size: 1.2em;
            margin: .6em 0;
        }

        div#users-contain {
            width: 350px;
            margin: 20px 0;
        }

        div#users-contain table {
            margin: 1em 0;
            border-collapse: collapse;
            width: 100%;
        }

        div#users-contain table td,
        div#users-contain table th {
            border: 1px solid #eee;
            padding: .6em 10px;
            text-align: left;
        }

        .ui-dialog .ui-state-error {
            padding: .3em;
        }

        .validateTips {
            border: 1px solid transparent;
            padding: 0.3em;
        }
    </style>

    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
</head>

<body>
    <div class="container-fluid" >
    <%# navbar-light bg-light %>
                <nav class="navbar fixed-top navbar-expand-lg navbar-light1 bg-light navbar-light">
            <span class="navbar-brand">Admin</span>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse mx-5" id="navbarNav">
                <ul class="navbar-nav">
                <li class="nav-item ">
                    <a class="nav-link" href="http://localhost:5000/admin" >product </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://localhost:5000/admin/catigory" >catigory</a>
                </li>
                </ul>
            </div>
            </nav>
            
            <div class="row">
            <div class="col-sm-12 my-4">
            </div>
            </div>

        <div class="row" id="productpage">
            <div class="col-sm-2 ">
            </div>
            <div class="col-sm-8 my-4">
                <div class="row">
                    <div class="col-sm-5 "></div>
                    <div class="col-sm-2 xm-auto">
                        <% if (maincat==null){%>All product
                            <%}else{%>
                                <%=maincat%>
                                    <%}%>
                    </div>
                    <div class="col-sm-4"></div>
                </div>
                <button id="create-user">Create new product</button>
                <table id="product" class="table table-dark table-bordered" bord>
                    <thead>
                        <tr>

                            <th scope="col">Name</th>
                            <th scope="col">Image</th>
                            <th scope="col">Price</th>
                            <th scope="col">Update</th>
                            <th scope="col">Delete</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% for(var i=products.length-1; i >= 0; i--) {if(matshcat==true){if(maincat==products[i].NameCat){%>
                            <tr id="<%=i%>">

                                <td>
                                    <%= products[i].Name %>
                                </td>
                                <td>
                                    <img src="<%= 'images/'+products[i].image%>" alt="..." class="img-thumbnail" width="100" height="50">
                                </td>
                                <td>
                                    <%= products[i].price %>
                                </td>
                                <td>
                                        <button type="button" class="btn btn-dark updateproduct" id="updateproduct"onclick="updateproduct( '<%=products[i].Name%>',,<%=i%>)">Update</button>
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-danger"  onclick="deletproduct('<%=products[i].Name%>',<%=i%>)">Delete</button>
                                    </td>
                            </tr>
                            <% }}else{%>

                                <tr id="<%=i%>">

                                    <td>
                                        <%= products[i].Name %>
                                    </td>
                                    <td>
                                        <img src="<%= 'images/'+products[i].image%>" alt="..." class="img-thumbnail" width="100" height="50">
                                    </td>
                                    <td>
                                        <%= products[i].price %>
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-dark updateproduct" id="updateproduct" onclick="updateproduct('<%=products[i].Name%>',<%=i%>)">Update</button>
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-danger"  onclick="deletproduct('<%=products[i].Name%>',<%=i%>)">Delete</button>
                                    </td>

                                </tr>
                                <%}} %>
                    </tbody>
                </table>



            </div>
            <div class="col-sm-2 my-4">
                <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false">
                        <% if (maincat==null){%>All Catigory
                            <%}else{%>
                                <%=maincat%>
                                    <%}%>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <% for(var i=0 ; i<catigorys.length ;i++) {%>
                            <a class="dropdown-item" href=" http://localhost:5000/admin?catigoryname=<%=catigorys[i].Name%>">
                                <%= catigorys[i].Name%>
                            </a>
                            <%}%>
                                <a class="dropdown-item" href='http://localhost:5000/admin'> All</a>
                    </div>
                </div>

            </div>
        </div>
        <!-- //////////////////////////////////////////////////////// -->
        <div id="dialog-form" title="Create new product">
            <form id="uploadForm" enctype="multipart/form-data"  method="post" action="http://localhost:5000/addproduct">
                
                    <label for="name">Name</label>
                    <input type="text" name="name" id="name" value="" class="text ui-widget-content ui-corner-all">
                    <label for="image">image</label>
                    <input type="file" name="image" id="image" value="" class="text ui-widget-content ui-corner-all">
                    <label for="price">price</label>
                    <input type="number" name="Price" id="Price" value="" class="text ui-widget-content ui-corner-all">
                    <select name="Namecat"form="uploadForm" id="Namecat" class="text ui-widget-content ui-corner-all" style="
                            border-left-width: 2px;
                            margin-left: 100px;
                            margin-bottom: 10px;
                        ">
                        <% for(var i=0 ; i<catigorys.length ;i++) {%>
                        <option value="<%= catigorys[i].Name%>"><%= catigorys[i].Name%></option>
                            <%}%>
                    </select>
                    <input type="hidden" name="updatechick" id="updatechick" value="" class="text ui-widget-content ui-corner-all">
                    <input type="hidden" name="updateid" id="updateid" value="" class="text ui-widget-content ui-corner-all">
                    <input type="hidden" name="nameval" id="nameval" value="" class="text ui-widget-content ui-corner-all">
                    <span id="status"></span>
                    <!-- Allow form submission with keyboard without duplicating the dialog button -->
                    <%# <input type="submit" tabindex="-1" style="position:absolute; top:-1000px"> %>
                    <input type="submit"  value="Save">
                    
                
            </form>
        </div>
        
    </div>

    <!-- ////////////////////////////////////////////////////////////////////////////////////////////// -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery.form/3.51/jquery.form.min.js"></script>

    <!-- /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        $(function () {
            var dialog, form,

                emailRegex = /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,
                name = $("#name"),
                image = $("#image"),
                Price = $("#Price"),
                NameCat=$("#Namecat")
                allFields = $([]).add(name).add(image).add(Price).add(NameCat),
                tips = $(".validateTips");

            function updateTips(t) {
                tips.text(t).addClass("ui-state-highlight");
                setTimeout(function () {
                    tips.removeClass("ui-state-highlight", 1500);
                }, 500);
            }

            function checkLength(o, n, min, max) {
                if (o.val().length > max || o.val().length < min) {
                    o.addClass("ui-state-error");
                    updateTips("Length of " + n + " must be between " +
                        min + " and " + max + ".");
                    return false;
                } else {
                    return true;
                }
            }

            function checkRegexp(o, regexp, n) {
                if (!(regexp.test(o.val()))) {
                    o.addClass("ui-state-error");
                    updateTips(n);
                    return false;
                } else {
                    return true;
                }
            }

            function addUser() {
                var valid = true;
                allFields.removeClass("ui-state-error");
                valid = valid && checkLength(name, "username", 3, 16);
                //valid = valid && checkLength(price, "price", 1, 6);
                valid = valid && checkRegexp(name, /^[a-z]([0-9a-z_\s])+$/i, "Username may consist of a-z, 0-9, underscores, spaces and must begin with a letter.");

                if (valid) {
                    $("#product tbody").prepend("<tr id='"+name.val()+"'>" +
                        "<td>" + name.val() + "</td>" +
                        "<td><img href='" + 'images/' + image.val() + "'alt='not found'></td>" +
                        "<td>" + Price.val() + "</td>" 
                        +`<td>
                                    <button type="button" class="btn btn-dark updateproduct ui-button ui-corner-all ui-widget" onclick="updateproduct('${name.val()}','${name.val()}')">Update</button>
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-danger" onclick="deletproduct('${name.val()}','${name.val()}')">Delete</button>
                                    </td></tr>`);
                }
                console.log($('#image').val());
          var product={};
          product.Name=$("#name").val();
          product.Price=$('#Price').val();
          product.image=$('#image').val();
          product.NameCat=$('#Namecat').val();
          console.log(product);
 console.log(JSON.stringify(product));
 debugger;
          $.ajax({
						type: 'POST',
                        data:(JSON.stringify(product)),
                        contentType: 'application/json',
                        url: 'http://localhost:5000/addproduct',						
                        success: function(data) {
                            console.log('success'); 
                            dialog.dialog("close");
                        },
                        error: function(err) {
                            console.log(err);
                            dialog.dialog("close");
                        }
                        
        });
        
                return valid;
            }

            ///////////////////
            function updateproductindb() {
                var valid = true;
                allFields.removeClass("ui-state-error");
                valid = valid && checkLength(name, "username", 3, 16);
                //valid = valid && checkLength(price, "price", 1, 6);
                valid = valid && checkRegexp(name, /^[a-z]([0-9a-z_\s])+$/i, "Username may consist of a-z, 0-9, underscores, spaces and must begin with a letter.");
                    
                if (valid) {
                    $(`#${$("#updateid").val()}`).html(
                        "<td>" + name.val() + "</td>" +
                        "<td><img href='" + 'images/' + image.val() + "'alt='not found'></td>" +
                        "<td>" + Price.val() + "</td>" 
                        +`<td>
                                        <button type="button" class="btn btn-dark updateproduct ui-button ui-corner-all ui-widget" onclick="updateproduct('${name.val()}','${$("#updateid").val()}')">Update</button>
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-danger" onclick="deletproduct('${name.val()}','${$("#updateid").val()}')">Delete</button>
                                    </td>`);

                }
                console.log($('#image').val());
          var product={};
          product.Name=$("#name").val();
          product.Price=$('#Price').val();
          product.image=$('#image').val();
          product.NameCat=$('#Namecat').val();
          product.nameval=$('#nameval').val();
          console.log(product);
 console.log(JSON.stringify(product));
 debugger;
          $.ajax({
						type: 'POST',
                        data:(JSON.stringify(product)),
                        contentType: 'application/json',
                        url: 'http://localhost:5000/updateproduct',						
                        success: function(data) {
                            console.log('success'); 
                            dialog.dialog("close");
                        },
                        error: function(err) {
                            console.log(err);
                            dialog.dialog("close");
                        }
                        
        });
        
                return valid;
            }
            ///////////////////////////
            dialog = $("#dialog-form").dialog({
                autoOpen: false,
                height: 400,
                width: 350,
                modal: true,
                close: function () {
                    form[0].reset();
                    allFields.removeClass("ui-state-error");
                }
            });
            debugger;
            form = dialog.find("form").on("submit", function (event) {
                event.preventDefault();
                // $("#uploadForm").ajaxSubmit({url: 'http://localhost:5000/addproduct', type: 'post'})
                if($('#updatechick').val()=="no")
                addUser();
                else
                updateproductindb();
                dialog.dialog("close");
            });

            $("#create-user").button().on("click", function () {
                $('#updatechick').val("no");
                dialog.dialog("open");
            });
         
            $( ".updateproduct" ).button().on("click", function () {
                debugger;
                setTimeout(()=>{dialog.dialog("open");},0); 
                console.log("skjsksksksksksjjjshshshskoko");
            });

            
            
        });
    </script>
        <script>


        function deletproduct(name,id)
        {
            debugger;
            $.ajax({
            type: 'DELETE',
            url: '/deletepro/'+name,
            success: function(response){
                alert('Delete');
                
            },
            error: function(err){
                console.log(err);
            }

        });
        $(`#${id}`).remove();

        }

       function updateproduct(name,nummid)
            {
                debugger;
                nameofproduct=name;
                numofproductid=nummid;
                var parameters={Name:name};
                console.log(JSON.stringify(parameters));
                var pp=JSON.stringify(parameters);
                $.get( `/getproduct/${name}`, function(data) {
                     $('#name').val(data.Name);
                    // $('#image').val("/images/"+data.image);
                     $('#Price').val(data.price);
                     $('#Namecat').val(data.NameCat);
                     console.log(data);
                });
               // opendialog();
                //dialog.dialog("open");
                $('#updatechick').val("yes");
                $('#updateid').val(nummid);
                $('#nameval').val(name);
            };
        
    </script>
    <%# ///////////////////////////////////////////////////////////////////// %>
    
</body>

</html>